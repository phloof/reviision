{% extends "base.html" %}

{% block title %}Demographics Analysis - ReViision{% endblock %}

{% block styles %}
<style>
/* Demographics-specific styles using design system */
.chart-container {
    position: relative;
    height: 400px;
    width: 100%;
}

.demographic-stat {
    text-align: center;
    padding: var(--spacing-4);
    background: var(--color-surface-secondary);
    border-radius: var(--radius-lg);
    transition: var(--transition-all);
}

.demographic-stat:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.demographic-stat-value {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary-600);
    margin-bottom: var(--spacing-2);
}

.demographic-stat-label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.filter-section {
    background: var(--color-surface-primary);
    border: 1px solid var(--color-border-primary);
    border-radius: var(--radius-xl);
    padding: var(--spacing-6);
    margin-bottom: var(--spacing-6);
}

@media (max-width: 767px) {
    .chart-container {
        height: 300px;
    }

    .demographic-stat-value {
        font-size: var(--font-size-2xl);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container py-6">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-primary mb-2">Demographics Analysis</h1>
        <p class="text-secondary">Comprehensive customer demographic insights and trends</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="card mb-6">
        <div class="card-body p-4">
            <nav class="nav nav-pills d-flex flex-wrap gap-2" id="demographics-nav">
                <a class="nav-link active" href="#overview" data-section="overview">
                    <i class="fas fa-chart-pie mr-2"></i>
                    Overview
                </a>
                <a class="nav-link" href="#age-analysis" data-section="age">
                    <i class="fas fa-birthday-cake mr-2"></i>
                    Age Analysis
                </a>
                <a class="nav-link" href="#gender-analysis" data-section="gender">
                    <i class="fas fa-venus-mars mr-2"></i>
                    Gender Analysis
                </a>
                <a class="nav-link" href="#emotion-analysis" data-section="emotion">
                    <i class="fas fa-smile mr-2"></i>
                    Emotion Analysis
                </a>
                <a class="nav-link" href="#trends" data-section="trends">
                    <i class="fas fa-chart-line mr-2"></i>
                    Trends
                </a>
            </nav>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filter-section">
        <h3 class="text-lg font-semibold mb-4">
            <i class="fas fa-filter text-primary mr-2"></i>
            Data Filters
        </h3>
        <div class="d-grid grid-cols-1 tablet-grid-cols-2 desktop-grid-cols-4 gap-4">
            <div class="form-group">
                <label for="time-range" class="form-label">Time Range</label>
                <select class="form-control" id="time-range">
                    <option value="1h">Last Hour</option>
                    <option value="6h">Last 6 Hours</option>
                    <option value="24h" selected>Last 24 Hours</option>
                    <option value="7d">Last 7 Days</option>
                    <option value="30d">Last 30 Days</option>
                </select>
            </div>
            <div class="form-group">
                <label for="age-filter" class="form-label">Age Group</label>
                <select class="form-control" id="age-filter">
                    <option value="all">All Ages</option>
                    <option value="child">Children (0-12)</option>
                    <option value="teen">Teenagers (13-19)</option>
                    <option value="adult">Adults (20-64)</option>
                    <option value="senior">Seniors (65+)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="gender-filter" class="form-label">Gender</label>
                <select class="form-control" id="gender-filter">
                    <option value="all">All Genders</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
            </div>
            <div class="form-group d-flex items-end">
                <button class="btn btn-primary w-full" id="apply-filters">
                    <i class="fas fa-search"></i>
                    Apply Filters
                </button>
            </div>
        </div>
    </div>
    <!-- Content Sections -->
    <div id="content-sections">
        <!-- Overview Section -->
        <div id="overview-section" class="content-section">
            <!-- Summary Stats -->
            <div class="d-grid grid-cols-2 desktop-grid-cols-4 gap-4 mb-8">
                <div class="demographic-stat">
                    <div class="demographic-stat-value" id="total-visitors">--</div>
                    <div class="demographic-stat-label">Total Visitors</div>
                </div>
                <div class="demographic-stat">
                    <div class="demographic-stat-value" id="avg-age">--</div>
                    <div class="demographic-stat-label">Average Age</div>
                </div>
                <div class="demographic-stat">
                    <div class="demographic-stat-value" id="male-percentage">--</div>
                    <div class="demographic-stat-label">Male %</div>
                </div>
                <div class="demographic-stat">
                    <div class="demographic-stat-value" id="female-percentage">--</div>
                    <div class="demographic-stat-label">Female %</div>
                </div>
            </div>

            <!-- Overview Charts -->
            <div class="d-grid grid-cols-1 desktop-grid-cols-2 gap-6">
                <div class="card">
                    <div class="card-header card-header-primary">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Age Distribution
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="overview-age-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header card-header-success">
                        <h3 class="card-title">
                            <i class="fas fa-chart-donut"></i>
                            Gender Distribution
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="overview-gender-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Age Analysis Section -->
        <div id="age-section" class="content-section d-none">
            <div class="card mb-6">
                <div class="card-header card-header-warning">
                    <h3 class="card-title">
                        <i class="fas fa-birthday-cake"></i>
                        Detailed Age Analysis
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="detailed-age-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Age Trends -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Age Trends Over Time
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="age-trends-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gender Analysis Section -->
        <div id="gender-section" class="content-section d-none">
            <div class="d-grid grid-cols-1 desktop-grid-cols-2 gap-6">
                <div class="card">
                    <div class="card-header card-header-primary">
                        <h3 class="card-title">
                            <i class="fas fa-mars"></i>
                            Male Demographics
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="male-demographics-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header card-header-danger">
                        <h3 class="card-title">
                            <i class="fas fa-venus"></i>
                            Female Demographics
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="female-demographics-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gender Trends -->
            <div class="card mt-6">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-area"></i>
                        Gender Distribution Trends
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="gender-trends-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emotion Analysis Section -->
        <div id="emotion-section" class="content-section d-none">
            <div class="card mb-6">
                <div class="card-header card-header-success">
                    <h3 class="card-title">
                        <i class="fas fa-smile"></i>
                        Emotion Distribution
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="emotion-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Emotion by Demographics -->
            <div class="d-grid grid-cols-1 desktop-grid-cols-2 gap-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Emotions by Age Group
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="emotion-age-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Emotions by Gender
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="emotion-gender-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trends Section -->
        <div id="trends-section" class="content-section d-none">
            <div class="card">
                <div class="card-header card-header-primary">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Comprehensive Demographic Trends
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 500px;">
                        <canvas id="comprehensive-trends-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Demographics Content -->
    <div class="row">
        <!-- Filter Navigation -->
        <div class="col-12 mb-4">
            <div class="demographics-nav">
                <div class="nav nav-pills flex-row flex-wrap gap-2" id="v-pills-tab" role="tablist" aria-orientation="horizontal">
                    <button class="nav-link active" id="v-pills-charts-tab" data-bs-toggle="pill" data-bs-target="#v-pills-charts" type="button" role="tab">
                        <i class="fas fa-chart-pie me-2"></i>Charts
                    </button>
                    <button class="nav-link" id="v-pills-trends-tab" data-bs-toggle="pill" data-bs-target="#v-pills-trends" type="button" role="tab">
                        <i class="fas fa-chart-line me-2"></i>Trends
                    </button>
                    <button class="nav-link" id="v-pills-data-tab" data-bs-toggle="pill" data-bs-target="#v-pills-data" type="button" role="tab">
                        <i class="fas fa-table me-2"></i>Data Table
                    </button>
                </div>

                <!-- Time Range Filter -->
                <div class="mt-3">
                    <label for="time-range-2" class="form-label">Time Range</label>
                    <select class="form-select" id="time-range-2">
                        <option value="1h">Last Hour</option>
                        <option value="6h">Last 6 Hours</option>
                        <option value="24h" selected>Last 24 Hours</option>
                        <option value="7d">Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                    </select>
                </div>

                <div class="mt-3">
                    <button class="btn btn-primary w-100" id="refresh-demographics-2">
                        <i class="fas fa-sync-alt me-2"></i>Refresh Data
                    </button>
                </div>
            </div>
        </div>

        <!-- Demographics Content -->
        <div class="col-12">
            <div class="tab-content" id="v-pills-tabContent">

                <!-- Charts Tab -->
                <div class="tab-pane fade show active" id="v-pills-charts" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="demographics-section">
                                <h3 class="section-title">
                                    <span><i class="fas fa-users me-2"></i>Age Distribution</span>
                                </h3>
                                <div class="chart-container">
                                    <canvas id="ageChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="demographics-section">
                                <h3 class="section-title">
                                    <span><i class="fas fa-venus-mars me-2"></i>Gender Distribution</span>
                                </h3>
                                <div class="chart-container">
                                    <canvas id="genderChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trends Tab -->
                <div class="tab-pane fade" id="v-pills-trends" role="tabpanel">
                    <div class="demographics-section">
                        <h3 class="section-title">
                            <span><i class="fas fa-chart-line me-2"></i>Demographic Trends Over Time</span>
                        </h3>
                        <div class="chart-container">
                            <canvas id="demographicTrends"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Data Table Tab -->
                <div class="tab-pane fade" id="v-pills-data" role="tabpanel">
                    <div class="demographics-section">
                        <h3 class="section-title">
                            <span><i class="fas fa-table me-2"></i>Detailed Demographics Data</span>
                        </h3>

                        <!-- Table Controls -->
                        <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
                            <div class="input-group" style="width: 250px;">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                <input type="text" class="form-control" id="table-search" placeholder="Search records...">
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <select class="form-select" id="records-per-page" style="width: auto;">
                                    <option value="10">10 per page</option>
                                    <option value="25">25 per page</option>
                                    <option value="50">50 per page</option>
                                    <option value="100">100 per page</option>
                                </select>
                                <button type="button" class="btn btn-outline-primary" id="refresh-table" title="Refresh Data">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Table loading overlay -->
                        <div id="table-loading" class="table-loading-overlay" style="display: none;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="text-center">
                                    <div class="spinner-border text-primary mb-3" role="status"></div>
                                    <div>Loading records...</div>
                                </div>
                            </div>
                        </div>

                        <!-- Table container -->
                        <div class="table-responsive">
                            <table class="table table-striped table-hover table-modern" id="demographicsTable">
                                <thead class="table-dark sticky-top">
                                    <tr>
                                        <th class="sortable" data-sort="timestamp">
                                            <i class="fas fa-calendar me-1"></i>Date & Time
                                            <i class="fas fa-sort sort-icon"></i>
                                        </th>
                                        <th class="sortable" data-sort="gender">
                                            <i class="fas fa-venus-mars me-1"></i>Gender
                                            <i class="fas fa-sort sort-icon"></i>
                                        </th>
                                        <th class="sortable" data-sort="age">
                                            <i class="fas fa-birthday-cake me-1"></i>Age Group
                                            <i class="fas fa-sort sort-icon"></i>
                                        </th>
                                        <th class="sortable" data-sort="emotion">
                                            <i class="fas fa-smile me-1"></i>Emotion
                                            <i class="fas fa-sort sort-icon"></i>
                                        </th>
                                        <th class="sortable" data-sort="dwell_time">
                                            <i class="fas fa-clock me-1"></i>Dwell Time
                                            <i class="fas fa-sort sort-icon"></i>
                                        </th>
                                        <th class="sortable" data-sort="confidence">
                                            <i class="fas fa-percentage me-1"></i>Confidence
                                            <i class="fas fa-sort sort-icon"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="6" class="text-center text-muted py-4">
                                            <i class="fas fa-spinner fa-spin me-2"></i>Loading data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Table footer with pagination and info -->
                        <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap">
                            <div class="pagination-controls">
                                <nav aria-label="Table pagination">
                                    <ul class="pagination pagination-sm mb-0" id="table-pagination">
                                        <li class="page-item disabled">
                                            <button class="page-link" type="button" id="prev-page" title="Previous page">
                                                <i class="fas fa-chevron-left"></i>
                                                <span class="sr-only">Previous</span>
                                            </button>
                                        </li>
                                        <li class="page-item active">
                                            <button class="page-link" type="button" data-page="1">1</button>
                                        </li>
                                        <li class="page-item disabled">
                                            <button class="page-link" type="button" id="next-page" title="Next page">
                                                <i class="fas fa-chevron-right"></i>
                                                <span class="sr-only">Next</span>
                                            </button>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                            <div class="table-info">
                                <span id="table-info-text">Showing 0 of 0 records</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Additional Demographics Styles */
.demographics-section {
    background: var(--color-surface-primary);
    border: 1px solid var(--color-border-primary);
    border-radius: var(--radius-xl);
    padding: var(--spacing-6);
    margin-bottom: var(--spacing-6);
}

.section-title {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-4);
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
}

.demographics-nav {
    background: var(--color-surface-primary);
    border: 1px solid var(--color-border-primary);
    border-radius: var(--radius-xl);
    padding: var(--spacing-6);
    margin-bottom: var(--spacing-6);
}

.chart-container {
    position: relative;
    height: 400px;
    width: 100%;
    margin-bottom: 1rem;
}

.chart-container canvas {
    max-height: 400px;
}

.tooltip {
    position: relative;
    display: inline-block;
    cursor: help;
}

.tooltip i {
    color: #6c757d;
    font-size: 1.1rem;
    transition: color 0.3s ease;
}

.tooltip:hover i {
    color: #3498db;
}

.tooltip-text {
    visibility: hidden;
    width: 200px;
    background-color: rgba(0, 0, 0, 0.9);
    color: white;
    text-align: center;
    border-radius: 8px;
    padding: 0.75rem;
    position: absolute;
    z-index: 1000;
    bottom: 125%;
    right: 0;
    font-size: 0.9rem;
    font-weight: 400;
    opacity: 0;
    transition: opacity 0.3s ease;
    backdrop-filter: blur(10px);
}

.tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

@media (max-width: 768px) {
    .chart-container {
        height: 300px;
    }
}

/* Notification Popup Styles */
.notification-popup {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1060;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
}

.notification-popup.show {
    opacity: 1;
    transform: translateX(0);
}

.notification-popup.fade-out {
    opacity: 0;
    transform: translateX(100%);
}

.notification-content {
    display: flex;
    align-items: center;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    min-width: 300px;
    max-width: 400px;
}

.notification-success {
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    color: white;
}

.notification-error {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
}

.notification-icon {
    margin-right: 1rem;
    font-size: 1.5rem;
}

.notification-message {
    flex: 1;
    font-weight: 500;
}
</style>
{% endblock %}
{% block scripts %}
<!-- Chart.js is now globally loaded via base.html; plugins & ChartManager included there -->
<script>
// Demographics Page JavaScript
class DemographicsManager {
    constructor() {
        this.charts = {};
        this.currentData = null;
        this.currentPage = 1;
        this.recordsPerPage = 10;
        this.currentSearch = '';
        this.currentSort = 'timestamp';
        this.currentSortOrder = 'desc';
        this.totalRecords = 0;
        this.totalPages = 0;
        this.init();
    }

    init() {
        this.setupEventHandlers();
        this.loadData();
        this.initializeTable();
    }

    setupEventHandlers() {
        // Time range change
        document.getElementById('time-range').addEventListener('change', () => {
            this.loadData();
            this.currentPage = 1;
            this.loadTableData();
        });

        // Refresh button
        document.getElementById('refresh-demographics').addEventListener('click', () => {
            this.loadData();
            this.loadTableData();
        });

        // Tab changes
        document.querySelectorAll('[data-bs-toggle="pill"]').forEach(tab => {
            tab.addEventListener('shown.bs.tab', (e) => {
                this.handleTabChange(e.target);
            });
        });
    }

    handleTabChange(tab) {
        // Resize charts when tab becomes visible
        setTimeout(() => {
            Object.values(this.charts).forEach(chart => {
                if (!chart) return;
                if (typeof chart.resize === 'function') {
                    chart.resize();
                } else if (chart.chart && typeof chart.chart.resize === 'function') {
                    chart.chart.resize();
                }
            });
        }, 100);
    }

    async loadData() {
        try {
            const hours = this.getHoursFromRange();
            const response = await fetch(`/api/analytics/historical?hours=${hours}`);

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();

            if (data.success) {
                this.currentData = data;
                this.updateCharts(data);
                this.showSuccessMessage('Demographic data loaded successfully');
            } else {
                this.showNoDataState();
            }
        } catch (error) {
            console.error('Error loading data:', error);
            this.showNoDataState();
        }
    }

    showSuccessMessage(message) {
        this.showNotificationPopup('success', message);
    }

    showNotificationPopup(type, message) {
        // Remove any existing notifications
        const existingNotifications = document.querySelectorAll('.notification-popup');
        existingNotifications.forEach(notification => notification.remove());

        const popup = document.createElement('div');
        popup.className = 'notification-popup';
        popup.innerHTML = `
            <div class="notification-content notification-${type}">
                <div class="notification-icon">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                </div>
                <div class="notification-message">${message}</div>
            </div>
        `;

        document.body.appendChild(popup);

        // Trigger animation
        setTimeout(() => {
            popup.classList.add('show');
        }, 100);

        // Auto-hide after 3 seconds
        setTimeout(() => {
            popup.classList.add('fade-out');
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.remove();
                }
            }, 300);
        }, 3000);
    }

    updateCharts(data) {
        this.createAgeChart(data);
        this.createGenderChart(data);
        this.createDemographicTrendsChart(data);
    }

    createAgeChart(data) {
        const ctx = document.getElementById('ageChart');
        if (!ctx) return;

        if (this.charts.age) {
            this.charts.age.destroy();
        }

        const ageData = data.age_groups || {};
        const labels = Object.keys(ageData);
        const values = Object.values(ageData);

        const ageConfig = {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Visitors by Age Group',
                    data: values,
                    backgroundColor: [
                        'rgba(52, 152, 219, 0.7)',
                        'rgba(46, 204, 113, 0.7)',
                        'rgba(155, 89, 182, 0.7)',
                        'rgba(241, 196, 15, 0.7)',
                        'rgba(230, 126, 34, 0.7)',
                        'rgba(231, 76, 60, 0.7)'
                    ],
                    borderColor: [
                        'rgba(52, 152, 219, 1)',
                        'rgba(46, 204, 113, 1)',
                        'rgba(155, 89, 182, 1)',
                        'rgba(241, 196, 15, 1)',
                        'rgba(230, 126, 34, 1)',
                        'rgba(231, 76, 60, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Visitors'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Age Group'
                        }
                    }
                }
            }
        };

        this.charts.age = new ChartManager(ctx, ageConfig, { filename: 'age_distribution' });
        this.attachToolbar('ageChart', this.charts.age);
    }

    getHoursFromRange() {
        const range = document.getElementById('time-range').value;
        const map = {
            '1h': 1,
            '6h': 6,
            '24h': 24,
            '7d': 168,
            '30d': 720
        };
        return map[range] || 24;
    }

    showNoDataState() {
        // Clear charts
        Object.values(this.charts).forEach(chart => {
            if (chart) {
                chart.destroy();
            }
        });
        this.charts = {};
    }

    initializeTable() {
        // Table functionality would go here
        console.log('Table initialized');
    }

    attachToolbar(chartId, chart) {
        // Toolbar functionality would go here
        console.log('Toolbar attached for', chartId);
    }
}

// Initialize demographics manager when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    new DemographicsManager();
});
</script>
{% endblock %}
