{% extends "base.html" %}

{% block title %}Historical Data - ReViision{% endblock %}

{% block header %}Historical Data{% endblock %}

{% block styles %}
<style>
    .chart-container {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-bottom: 20px;
    }
    .filter-bar {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        padding: 15px;
        margin-bottom: 20px;
    }
    .stats-card {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-bottom: 20px;
        text-align: center;
    }
    .stats-card h3 {
        font-size: 2.5rem;
        font-weight: 500;
        margin-bottom: 5px;
    }
    .stats-card p {
        color: #6c757d;
        margin-bottom: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="filter-bar">
    <div class="row align-items-center">
        <div class="col-md-4">
            <div class="form-group">
                <label for="date-range">Date Range</label>
                <select class="form-select" id="date-range">
                    <option value="today">Today</option>
                    <option value="yesterday">Yesterday</option>
                    <option value="last7days" selected>Last 7 Days</option>
                    <option value="last30days">Last 30 Days</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="metric-select">Metric</label>
                <select class="form-select" id="metric-select">
                    <option value="visitors" selected>Visitors</option>
                    <option value="dwell-time">Dwell Time</option>
                    <option value="demographics">Demographics</option>
                    <option value="heatmap-density">Heatmap Density</option>
                </select>
            </div>
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button class="btn btn-primary mt-2 w-100" id="apply-filters">Apply Filters</button>
        </div>
    </div>
    <div class="row mt-3 custom-date-range" style="display: none;">
        <div class="col-md-4">
            <div class="form-group">
                <label for="start-date">Start Date</label>
                <input type="date" class="form-control" id="start-date">
            </div>
        </div>
        <div class="col-md-4">
            <div class="form-group">
                <label for="end-date">End Date</label>
                <input type="date" class="form-control" id="end-date">
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-3">
        <div class="stats-card">
            <h3 id="total-visitors">2,458</h3>
            <p>Total Visitors</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <h3 id="average-dwell">5:23</h3>
            <p>Average Dwell Time</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <h3 id="peak-hour">14:00</h3>
            <p>Peak Hour</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <h3 id="conversion-rate">32%</h3>
            <p>Conversion Rate</p>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-8">
        <div class="chart-container">
            <h5>Visitor Traffic Over Time</h5>
            <canvas id="traffic-chart"></canvas>
        </div>
    </div>
    <div class="col-md-4">
        <div class="chart-container">
            <h5>Visitor Demographics</h5>
            <canvas id="demographics-chart"></canvas>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="chart-container">
            <h5>Dwell Time Distribution</h5>
            <canvas id="dwell-chart"></canvas>
        </div>
    </div>
    <div class="col-md-6">
        <div class="chart-container">
            <h5>Traffic by Day of Week</h5>
            <canvas id="week-chart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Toggle custom date range inputs
    document.getElementById('date-range').addEventListener('change', function() {
        const customDateRange = document.querySelector('.custom-date-range');
        if (this.value === 'custom') {
            customDateRange.style.display = 'flex';
        } else {
            customDateRange.style.display = 'none';
        }
    });

    // Initialize charts when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Traffic over time chart
        const trafficCtx = document.getElementById('traffic-chart').getContext('2d');
        const trafficChart = new Chart(trafficCtx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Visitors',
                    data: [320, 280, 305, 350, 410, 510, 460],
                    backgroundColor: 'rgba(13, 110, 253, 0.1)',
                    borderColor: 'rgba(13, 110, 253, 1)',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Demographics chart
        const demographicsCtx = document.getElementById('demographics-chart').getContext('2d');
        const demographicsChart = new Chart(demographicsCtx, {
            type: 'doughnut',
            data: {
                labels: ['Male', 'Female', 'Unknown'],
                datasets: [{
                    data: [45, 52, 3],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(150, 150, 150, 0.8)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Dwell time chart
        const dwellCtx = document.getElementById('dwell-chart').getContext('2d');
        const dwellChart = new Chart(dwellCtx, {
            type: 'bar',
            data: {
                labels: ['<1m', '1-3m', '3-5m', '5-10m', '10m+'],
                datasets: [{
                    label: 'Visitors',
                    data: [120, 230, 310, 170, 50],
                    backgroundColor: 'rgba(75, 192, 192, 0.8)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Day of week chart
        const weekCtx = document.getElementById('week-chart').getContext('2d');
        const weekChart = new Chart(weekCtx, {
            type: 'bar',
            data: {
                labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                datasets: [{
                    label: 'Average Visitors',
                    data: [320, 290, 310, 340, 370, 500, 450],
                    backgroundColor: 'rgba(153, 102, 255, 0.8)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Apply filters button click
        document.getElementById('apply-filters').addEventListener('click', function() {
            const dateRange = document.getElementById('date-range').value;
            const metric = document.getElementById('metric-select').value;
            
            // Here you would normally fetch data from the server
            // For now, we'll just show an alert
            alert(`Fetching ${metric} data for ${dateRange} range`);
            
            // In a real implementation, you would make an API call here
            // and update the charts with the new data
        });
    });
</script>
{% endblock %} 