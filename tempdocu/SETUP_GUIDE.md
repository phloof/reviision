# ReViision Setup Guide

This guide helps you set up ReViision for different deployment environments using the centralized configuration system.

## Quick Start

1. **Configure your environment** in `setup_config.yaml`
2. **Run the setup script**: `python setup_reviision.py`
3. **Start the application**: `python src/main.py`

## Configuration Files

### `setup_config.yaml`
Main configuration file that defines:
- Network settings (IPs, ports, WiFi credentials)
- Camera configuration
- Security settings
- Deployment options
- Multiple environment profiles

### `src/config.yaml`
Application configuration (auto-generated by setup script)

## Environment Examples

### Current Pi Testbench Setup
```yaml
environment: "pi_testbench"
network:
  pi_ip: "192.168.1.60"
  camera_ip: "192.168.4.31"
  camera_port: 554
  external_port: 8554
  enable_port_forwarding: true
```

### Production Deployment
```yaml
environment: "production"
network:
  pi_ip: "10.0.1.100"
  camera_ip: "10.0.1.200"
  enable_port_forwarding: false
```

### Corporate Network
```yaml
environment: "corporate"
network:
  pi_ip: "172.16.0.100"
  camera_ip: "172.16.0.200"
  pi_hotspot_ssid: "ReViision-Corp"
```

## Setup Options

### Interactive Setup
```bash
python setup_reviision.py
```
- Lists available environments
- Prompts for environment selection
- Confirms settings before proceeding

### Direct Environment Setup
```bash
python setup_reviision.py pi_testbench
python setup_reviision.py production
python setup_reviision.py corporate
python setup_reviision.py phone_demo    # For client demonstrations
```

### Demo Environment (Phone Hotspot)
For client demonstrations using your phone's hotspot:
```bash
python setup_reviision.py phone_demo
```
- Simplified network topology
- Static IP on Raspberry Pi (192.168.43.100)
- Portable demonstration setup
- See `DEMO_SETUP_GUIDE.md` for detailed instructions

### What the Setup Does

1. **üîê Encryption Setup**
   - Generates or uses provided encryption key
   - Sets environment variables
   - Provides commands for persistent storage

2. **üåê Network Configuration**
   - Sets up port forwarding (Linux only)
   - Configures iptables rules
   - Provides manual setup instructions for other platforms

3. **‚öôÔ∏è Application Configuration**
   - Updates `src/config.yaml` with environment settings
   - Configures camera URL as 'url' field based on network topology
   - Sets logging levels and database paths

4. **üîß System Service (Optional)**
   - Creates systemd service files
   - Provides installation commands
   - Sets up auto-restart configuration

5. **‚úÖ Validation**
   - Checks required files exist
   - Tests network connectivity
   - Validates configuration

## Adding New Environments

### Method 1: Edit `setup_config.yaml`
Add new environment under `environments:` section:

```yaml
environments:
  my_new_env:
    network:
      pi_ip: "192.168.10.100"
      camera_ip: "192.168.10.200"
      external_port: 7554
    app:
      log_level: "DEBUG"
```

### Method 2: Create New Config File
1. Copy `setup_config.yaml` to `setup_config_new.yaml`
2. Modify the new file
3. Run: `python setup_reviision.py --config setup_config_new.yaml`

## Network Topologies

### Topology 1: Pi Hotspot + Port Forwarding
```
[Corporate Network] ‚Üí [Pi] ‚Üí [Pi Hotspot] ‚Üí [Camera]
     192.168.1.x     .60    192.168.4.x     .31
```
- Enable port forwarding: `true`
- External access via Pi IP

### Topology 2: Same Network
```
[Network] ‚Üí [Pi] + [Camera]
  10.0.1.x   .100    .200
```
- Enable port forwarding: `false`
- Direct camera access

### Topology 3: Corporate VLAN
```
[Corporate VLAN] ‚Üí [Pi] + [Camera]
    172.16.0.x      .100    .200
```
- Custom IP ranges
- Corporate firewall considerations

## Troubleshooting

### Common Issues

**‚ùå "Configuration load failed"**
- Check `setup_config.yaml` syntax
- Ensure file exists in current directory

**‚ùå "Environment not found"**
- Check environment name spelling
- List available environments: `python setup_reviision.py`

**‚ùå Port forwarding fails**
- Requires Linux with sudo access
- Check iptables permissions
- Verify network interfaces

**‚ùå Camera not accessible**
- Check IP addresses in config
- Verify network connectivity
- Test camera credentials

### Validation Commands

```bash
# Test camera connection
telnet 192.168.4.31 554

# Check port forwarding
netstat -tuln | grep 8554

# Verify environment variable
echo $REVIISION_KEY

# Test application config
python -c "import yaml; print(yaml.safe_load(open('src/config.yaml')))"
```

## Migration Between Environments

### From Development to Production
1. Update `setup_config.yaml` with production IPs
2. Run: `python setup_reviision.py production`
3. Deploy to production server
4. Start service

### Moving to New Network
1. Update network settings in config
2. Re-run setup with new environment
3. Update firewall rules if needed
4. Restart application

## Security Considerations

- **Encryption Keys**: Never commit keys to version control
- **Credentials**: Use strong camera passwords
- **Network**: Isolate camera networks when possible
- **Access**: Restrict Pi SSH access
- **Firewall**: Configure appropriate rules

## Support

For issues or questions:
1. Check this guide first
2. Validate your configuration
3. Run setup in verbose mode
4. Check application logs 